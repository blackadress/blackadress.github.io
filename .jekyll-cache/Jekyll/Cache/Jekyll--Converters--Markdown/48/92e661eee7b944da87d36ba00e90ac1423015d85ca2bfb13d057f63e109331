I"û)<p>Un servidor de eco es una aplicaciÃ³n que permite la conexiÃ³n entre cliente y servidor
de forma tal que el cliente pueda mandar un mensaje al servidor y el servidor reciba
el mensaje y reenviarlo (hacer eco) al cliente.</p>

<p>El nombre es autodescriptivo, no es un concepto complicado. Si el cliente manda â€˜Holaâ€™,
el servidor recibe â€˜Holaâ€™ y manda â€˜Holaâ€™ al cliente. 
El proyecto es sencillo y podemos usarlo para aprender acerca de Web Sockets, bien empecemos.</p>

<p>Lo primero que necesitamos es crear el proyecto con node:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir </span>echo-server <span class="o">&amp;&amp;</span> <span class="nb">cd </span>echo-server <span class="o">&amp;&amp;</span> npm init <span class="nt">-y</span>
</code></pre></div></div>
<p>Ahora instalemos las dependencias, utilizaremos la librerÃ­a â€˜wsâ€™ por ser bastante transparente
y el siempre confiable â€˜expressâ€™ como servidor.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm i express ws
</code></pre></div></div>

<p>Crearemos el punto de entrada de la aplicaciÃ³n â€˜index.jsâ€™ y adentro vamos a definir nuestro servidor.</p>

<p>Lo primero que haremos es importar todas las librerÃ­as que necesitaremos.
Primero el siempre confiable â€˜expressâ€™, tambiÃ©n necesitamos el mÃ³dulo â€˜httpâ€™ de node y
finalmente la librerÃ­a de WebSocket â€˜wsâ€™.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">ws</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>

<p>Ahora definamos el puerto e inicializamos el servidor express, luego inicializamos el servidor de â€˜httpâ€™.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">3000</span>

<span class="kd">let</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
<span class="kd">let</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">Server</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
</code></pre></div></div>

<p>Ahora inicializamos el WebSocket, como argumento le pasamos un objeto con los parametros â€˜serverâ€™ y â€˜pathâ€™.
Las conexiones que llegan al servidor las manejaremos mediante eventos, â€˜on connectionâ€™ es el evento que se dispara
cuando el servidor obtiene una conexiÃ³n; el evento â€˜on messageâ€™ se dispara cuando el â€˜socketâ€™ recibe un mensaje.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">wss</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span> <span class="na">server</span><span class="p">:</span> <span class="nx">server</span><span class="p">,</span> <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/echo</span><span class="dl">'</span>  <span class="p">})</span>

<span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">connection</span><span class="p">(</span><span class="nx">ws</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">incoming</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">received: %s</span><span class="dl">'</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
    <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="p">});</span>
 
  <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">ConexiÃ³n con el servidor de eco exitosa</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>
<p>Finalmente iniciamos a escuchar en el servidor.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Aplicacion corriendo en puerto:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">PORT</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Este es todo el cÃ³digo.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">WebSocket</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">ws</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">PORT</span> <span class="o">=</span> <span class="mi">3000</span>

<span class="kd">let</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
<span class="kd">let</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">Server</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">wss</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">Server</span><span class="p">({</span> <span class="na">server</span><span class="p">:</span> <span class="nx">server</span><span class="p">,</span> <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/echo</span><span class="dl">'</span>  <span class="p">})</span>

<span class="nx">wss</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">connection</span><span class="p">(</span><span class="nx">ws</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">incoming</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">received: %s</span><span class="dl">'</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
    <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
  <span class="p">});</span>
 
  <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">ConexiÃ³n con el servidor de eco exitosa</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Aplicacion corriendo en puerto:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">PORT</span><span class="p">)</span>
<span class="p">})</span>

</code></pre></div></div>

<p>Ahora que ya tenemos nuestro servidor, tenemos que escribir un cliente.
Para hacer esto solo necesitamos una pÃ¡gina html y algo de javascript.
Creamos un documento â€˜index.htmlâ€™, lo Ãºnico que importa de este documento
es el javascript, puedes anexarlo como un documento separado con el tag <script:src>
o directamente escribir en un tag <script></script></script:src></p>

<p>Â´Â´Â´javascript
Â´Â´Â´</p>
:ET